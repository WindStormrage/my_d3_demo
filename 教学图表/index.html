<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://lib.baomitu.com/d3/6.7.0/d3.min.js"></script>
    <title>d3</title>
    <style>
      .svg {
        border: 1px solid red;
      }
    </style>
  </head>

  <body>
    <!-- åˆ›å»ºsvgå®¹å™¨ -->
    <svg height="500" width="500" class="svg"></svg>
    <script>
      (async () => {
        // åŸºæœ¬å®¹å™¨æ¡†æ¶å®šä¹‰
        const width = 500
        const height = 500
        const padding = 50
        const innerWidth = width - padding * 2
        const innerHeight = height - padding * 2
        const xName = 'å›½å®¶'
        const yName = 'ğŸ…'

        // æ•°æ®å¼•å…¥
        let data = await d3.csv('./data.csv')
        let data_0 = await d3.csv('./data_0.csv')
        // console.log(data);

        // åˆ›å»ºæ¯”ä¾‹å°º
        const scaleX = d3.scaleBand()
          .domain(data.map(i => i[xName]))
          .range([0, innerWidth])
          // xä¸éœ€è¦æ’‘æ»¡
          .padding(0.5)
        const scaleY = d3.scaleLinear()
          .domain([0, d3.max(data, i => i[yName])])
          .range([0, innerWidth])
          // ä¼šå‘ç°yè½´åè¿‡æ¥äº†
          .range([innerWidth, 0])
          .nice()

        // å®šä¹‰åæ ‡è½´
        const xAxis = d3.axisBottom(scaleX)
        const yAxis = d3.axisLeft(scaleY)
        // console.log(xAxis);

        // æ·»åŠ æŸ±å›¾å®¹å™¨, ç”¨æ¥æ”¾ç½®åæ ‡è½´å’Œåé¢çš„å›¾å½¢,
        const bar = d3.select('svg')
          .append('g')
          .attr('id', 'bar')
          .attr('transform', `translate(${padding}, ${padding})`);

        // æŠŠåæ ‡è½´æ·»åŠ åˆ°å…ƒç´ ä¸Š, gå…ƒç´ ç”¨æ¥åˆ†ç»„ç®¡ç†
        bar.append('g')
          .call(xAxis)
          // xè½´éœ€è¦åç§»
          .attr('transform', `translate(0, ${innerHeight})`)
        bar.append('g')
          .call(yAxis)
        // ä¸ä½¿ç”¨callçš„æ–¹æ³•
        // yAxis(bar.append('g'))

        // ç»˜åˆ¶å›¾è¡¨
        // console.log(d3.select('g'))

        const barGroup = bar.append('g')
        // å¾ªç¯å®ç°
        // data.forEach((item) => {
        //   barGroup
        //     .append('rect')
        //     .attr('width', scaleX.bandwidth)
        //     .attr('height', innerHeight - scaleY(item[yName]))
        //     .attr('x', scaleX(item[xName]))
        //     .attr('y', scaleY(item[yName]))
        //     .attr('fill', 'pink')
        // });

        // dataç»‘å®šå®ç°
        // data.forEach((item) => {
        //   barGroup.append('rect')
        // })
        // const allRect = barGroup
        //   .selectAll('rect')
        //   .data(data)
        //   .attr('width', scaleX.bandwidth)
        //   .attr('height', d => innerHeight - scaleY(d[yName]))
        //   .attr('x', d => scaleX(d[xName]))
        //   .attr('y', d => scaleY(d[yName]))
        //   .attr('fill', 'pink')
        // å¯ä»¥çœ‹åˆ°æ•°æ®ç»‘å®šçš„ä½ç½®, __data__
        // console.log(allRect)


        // datajoinæ–¹å¼
        function update() {
          barGroup
            .selectAll('rect')
            .data(data, (d, i) => {
              console.log(d);
              return d[xName]
              return d['åºå·']
            })
            .join('rect')
            .on('mouseenter', function() {
              this.style.fill = 'yellow'
            })
            .on('mouseleave', function() {
              this.style.fill = 'yellowgreen'
            })
            .transition()
            .duration(2000)
            .attr('width', scaleX.bandwidth)
            .attr('height', d => innerHeight - scaleY(d[yName]))
            .attr('x', d => scaleX(d[xName]))
            .attr('y', d => scaleY(d[yName]))
            .attr('fill', 'pink')

        }
        update()
        setTimeout(() => {
          data = data_0
          update()
        }, 3000);

      })()
    </script>
  </body>

</html>